name: bitbucket3
root: ~/dev/repos/atlassian/bitbucket/main/bitbucket

on_project_start:
  - make config virtualenv && docker compose up -d && ./supervisorctl start all
  # - export LDFLAGS="-L/usr/local/opt/libgit2@1.5/lib"
  # - export CPPFLAGS="-I/usr/local/opt/libgit2@1.5/include"

pre_window:
  # - export LDFLAGS="-L/usr/local/opt/libgit2@1.5/lib"
  # - export CPPFLAGS="-I/usr/local/opt/libgit2@1.5/include"

windows:
  - zsh:
      layout: even-vertical
      panes:
        - gulp:
            - yarn cache clean && yarn && npx gulp watch
        - shell_plus:
            # - make config virtualenv && docker compose down && docker compose up -d && ./supervisorctl restart all
            - ./devbucket ./manage.py shell_plus
        - zsh: g s
        - zsh:
  - vim:
    - vim
  - logs:
      layout: even-vertical
      panes:
        - logs:
            - docker compose logs -f
        - logs:
          - ./supervisorctl tail -f website
        - logs:
          - ./supervisorctl tail -f api
        - logs:
          - ./supervisorctl tail -f background-tasks
  # - orochi:
  #     root: ~/dev/repos/atlassian/orochi
  #     layout: even-vertical
  #     panes:
  #       - vim:
  #         - vim
